
<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>NYC Tech Talks - OUTLOUD.FM</title>
	
	<!-- Core and extension CSS files -->
	<link rel="stylesheet" href="prettify.css">
	<link rel="stylesheet" href="../core/deck.core.css">
	<link rel="stylesheet" href="../extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="../extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="../extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="../extensions/status/deck.status.css">
	<link rel="stylesheet" href="../extensions/hash/deck.hash.css">
	
	<!-- Theme CSS files (menu swaps these out) -->
	<link rel="stylesheet" id="style-theme-link" href="../themes/style/web-2.0.css">
	<link rel="stylesheet" id="transition-theme-link" href="../themes/transition/horizontal-slide.css">
	
	<!-- Custom CSS just for this page -->
	<link rel="stylesheet" href="introduction.css">
	<script src="../modernizr.custom.js"></script>
	<script src="prettify.js"></script>
</head>

<body class="deck-container" onload="prettyPrint()">

<div class="theme-menu"><!--{{{-->
	<h2>Themes</h2>	
	
	<label for="style-themes">Style:</label>
	<select id="style-themes">
		<option selected value="../themes/style/web-2.0.css">Web 2.0</option>
		<option value="../themes/style/swiss.css">Swiss</option>
		<option value="../themes/style/neon.css">Neon</option>
		<option value="">None</option>
	</select>
	
	<label for="transition-themes">Transition:</label>
	<select id="transition-themes">
		<option selected value="../themes/transition/horizontal-slide.css">Horizontal Slide</option>
		<option value="../themes/transition/vertical-slide.css">Vertical Slide</option>
		<option value="../themes/transition/fade.css">Fade</option>
		<option value="">None</option>
	</select>
</div><!--}}}-->

<div class="slide" id="title-slide"><!--{{{-->
	<h1>NYC Tech Talks - OUTLOUD.FM</h1>
</div><!--}}}-->

<div class="slide" id="introduction">
	<h2>Introduction</h2>
	<ul>
    <li>
			<h3>outloud.fm is:</h3>
      <p>Social, collaborative <b>real-time</b>sharing of music</p>
		</li>
    <li>
      <p>Built over nights and weekends starting in march 2011</p>
		</li>
    <li>
      <p>over 100,000+ songs uploaded</p>
		</li>
    <li>
      <p>about 6,000 active users</p>
		</li>
    <li>
      <p>over 8,000 songs "liked" (added to favorites list)</p>
		</li>
	</ul>
</div>

<div class="slide" id="introduction">
	<h2>What we'll talk about</h2>
	<ul>
    <li>
			<h3>Overall architecture</h3>
		</li>
    <li>
      <h3>Some useful lessons learned</h2>
      <ul>
        <li>How to use redis as a messaging hub</li>
        <li>Pros/Cons of using node.js and a few notes on using it in production</li>
      </ul>
    </li>
    <li>
      <h2>How MP3 Streaming works</h2>
      <ul>
        <li>How to use redis as a messaging hub</li>
      </ul>

    </li>
	</ul>
</div>


<div class="slide" id="arch-tech-overview">
	<h2>Technologies</h2>
	<ul>
    <li class="slide">
      <h3>outloud.fm is hosted on Linode.com </h3>
      <p> <img src="http://www.linode.com/images/linode_logo_gray.png"></img> </p>
		</li>
		<li class="slide">
			<h3>Streaming Servers + Application Servers are built (mostly) on node.JS</h3>
      <p> <img src="http://nodejs.org/logos/nodejs-black.png"/> </p>
		</li>

		<div class="slide">
      <p>(with a little help from python)</p>
		</div>

		<li class="slide">
			<h3>We use redis (redis.io) for persistence and messaging</h3>
      <p> <img width="300px" src="http://www.thebigbugtheory.com/wp-content/uploads/2010/12/82.png"/> </p>
		</li>
	</ul>
</div>

<div class="slide" id="arch-stuff">
  <h2>Architecture - High Level</h2>
  <ul>
    <li class="slide">Application Server (Node.JS) handles basic http request and chat connections</li>
    <li class="slide">Streaming Server (Node.JS) loads MP3 Files from the filesystem and serves them in real time</li>
    <li class="slide">Several task processors (python + other stuff) consume messages from a messaging queue + process jobs</li>
    <li class="slide">All of these components talk to each other via Redis <b>(details on this later)</b></li>
  </ul>
</div>

<div class="slide" id="archdiagram">
  <img src="outloud_arch.png" alt="" />
</div>

<div class="slide" id="redis-messaging">
  <h2>Messaging - For <b>real-time</b> events throughout the site</h2>
  <ul>
    <li><p>Upload Finished &rarr; Notify preprocessor(s) that a new file is ready</p></li>
    <li><p>Preprocessing Finished &rarr; Notify streaming server(s) that a new file is on the queue</p></li>
    <li><p>Incoming Chat Message &rarr; Notify users in the channel</p></li>
    <li><p>User enters or exits a Channel &rarr; Notify users in the chanel</p></li>
    <li><p>User "likes" a song &rarr; Notify users in the channel</p></li>
    <li><p>User deletes or adds to the queue &rarr; Update channel queue page</p></li>
    <li><p>Songs start or end &rarr; Update the "now playing" info</p></li>
  </ul>
</div>

<div class="slide" id="messaginghow1">
  <h2>Method One: Publish/Subscribe</h2>
  <ul>
    <li class="slide">
    <p>Your process(es) connect to redis and call <b>redisClient.subscribe(&lt;channel&gt;)</b></p>
      <p>Attach an event handler (callback) to the "message" event for your pub/sub client</p>
    </li>

    <li class="slide">
      <p>Then from any other redis connection, call redisClient.publish(&lt;channel&gt;, &lt;message&gt;)</p>
    </li>

    <li class="slide">
      <p>When a message is published, the "message" event will be fired on any process subscribed to that channel</p>
    </li>

    <li class="slide">
      <p>Redis can efficiently handle thousands+ of distinct channels</p>
    </li>

    <li class="slide">
      <p>The "message" is just a string, so you can use JSON/Protocol Buffers/Whatever serialization you like (we use json)</p>
    </li>
  </ul>
</div>

<!-- Put a code sample here -->
<!--pubsubClient.subscribe("chatmessage");-->

<div class="slide" id="messaginghow2">
  <h2>Method Two: Lists and BLPOP/BRPOP</h2>
  <p>Great for messaging to processes that aren't event-based (python, etc)</p>
  <p>Excellent for a barebones <b>messaging queue</b> - run as many producers/consumers as you want</p>
  <ul>
    <li class="slide">Redis has a LIST datatype which supports O(1) push/pop from either end of the list: (LPUSH/LPOP and RPUSH/RPOP)</li>

    <li class="slide">These data types also support blocking pop: BLPOP, BRPOP, BRPOPLPUSH: the process will block until there's an item available to pop from the list</li>
    <li class="slide">Producers put messages onto the queue with RPUSH, consumers process them by calling LPOP</li>
    <li class="slide">In NodeJS (Application Server), after an upload completes, we queue up a message saying "upload is done!" like this:
    <pre>
      <code class="prettyprint">
        fileUpload.on("filedone", function(){
          var uploadedFileInfo = JSON.stringify({"path":fullPath,
                                                 "room":roomname, 
                                                 "uploader":uploaderInfo.name,
                                                 "uid":uploaderInfo.uidkey,
                                                 "fname":fname});
          redisClient.rpush("newsongready", uploadedFileInfo);
        });
      </code>
    </pre>
    
    
    
    </li>
    <li class="slide">Our python code for preprocessor looks like this:
      <pre><code class="prettyprint">
      while True:
        try:
          message = r.blpop("newsongready");
          songInfo = json.loads(message[1])
          parsedFile = loadMetaData(songInfo)
          processFile(parsedFile, songInfo, outputDir)
        except Exception, e: 
          print "Couldn't parse audio information, skipping:", e
          traceback.print_exc(file=sys.stdout)
      </code></pre>
    </li>
  </ul>
</div>




<div class="slide" id="whynodejs">
	<h2>Why Node.JS ?</h2>
	<ul>
    <li class="slide"> <p>Good performance while handling lots of concurrent connections</p> </li>
    <li class="slide"> <p>Easy to re-use code between the front-end and backend</p> </li>
    <li class="slide"> <p>Simple to get access at the protocol/socket level <b>(helpful for streaming!)</b></p> </li>
    <li class="slide"> <p>Writing asynchronous/event driven code is baked into the language, not a library or plugin (e.g. Twisted)</p> </li>
    <li class="slide"> <p>Helpful and active community, with lots of libraries out there</p> </li>
    <li class="slide"> <p>Javascript is fun</p> </li>
    <li class="slide"> <p>Node is so hip and I wanted to learn it</p> </li>
  </ul>
</div>

<div class="slide" id="whynodejs">
	<h2>Node gotchas</h2>
  <ul>
    <li>Chaining lots of callbacks gets ugly + hard to read! Break them out into reusable functions or use helper libs (async.js?)</li>
    <li>Single threaded... (nginx/haproxy in front?)</li>
    <li>Low-level can be a pain</li>
    <li>API is changing really quickly</li>
    <li>Debugging can be tricky, and NodeJS itself is young and may still have bugs, as well as its libraries</li>
    <li>Javascript is a drag sometimes (switch to Coffeescript maybe? whatever)</li>
  </ul>
</div>


<div class="slide" id="markup">
	<h2>The Markup</h2>
	<p>Slides are just HTML elements with a class of <code>slide</code>.</p>
	<pre><code>&lt;div class=&quot;slide&quot;&gt;
   &lt;h2&gt;How to Make a Deck&lt;/h2&gt;
   &lt;ol&gt;
      &lt;li&gt;
         &lt;h3&gt;Write Slides&lt;/h3&gt;
         &lt;p&gt;Slide content is simple HTML.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
         &lt;h3&gt;Choose Themes&lt;/h3&gt;
         &lt;p&gt;One for slide styles and one for deck transitions.&lt;/p&gt;
      &lt;/li&gt;
      &hellip;
   &lt;/ol&gt;
&lt;/div&gt;</code></pre>
</div>

<div class="slide" id="themes">
	<h2>Style Themes</h2>
	<p>Customizes the colors, typography, and layout of slide&nbsp;content.</p>
	<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/path/to/css/style-theme.css&quot;&gt;</code></pre>
	<h2>Transition Themes</h2>
	<p>Defines transitions between slides using CSS3 transitions.  Less capable browsers fall back to cutaways. But <strong>you</strong> aren&rsquo;t using <em>those</em> browsers to give your presentations, are&nbsp;you&hellip;</p>
	<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/path/to/css/transition-theme.css&quot;&gt;</code></pre>
</div>

<div class="slide" id="extensions">
	<h2>Extensions</h2>
	<p>Core gives you basic slide functionality with left and right arrow navigation, but you may want&nbsp;more. This deck includes all of them, so feel free to play around.</p>
	
	<ul>
		<li class="slide" id="extensions-goto">
			<strong>deck.goto</strong>: Adds a shortcut key to jump to any slide number.  Hit g, type in the slide number, and hit&nbsp;enter.
		</li>
		
		<li class="slide" id="extensions-hash">
			<strong>deck.hash</strong>: Enables internal linking within slides, deep linking to individual slides, and updates the address bar &amp; a permalink anchor with each slide&nbsp;change.
		</li>

		<li class="slide" id="extensions-menu">
			<strong>deck.menu</strong>: Adds a menu view, letting you see all slides in a grid. Hit m to toggle to menu view, continue navigating your deck, and hit m to return to normal&nbsp;view.
		</li>

		<li class="slide" id="extensions-navigation">
			<strong>deck.navigation</strong>: Adds clickable left and right buttons for the less keyboard inclined.
		</li>

		<li class="slide" id="extensions-status">
			<strong>deck.status</strong>: Adds a page number indicator. (current/total)
		</li>
	</ul>
	
	<p class="slide" id="extension-folders">Each extension folder in the download package contains the necessary JavaScript, CSS, and HTML&nbsp;files.</p>
</div>

<div class="slide" id="nested">
	<h2>Nested Slides</h2>
	<p>That last slide had a few steps.  To create substeps in slides, just nest them:</p>
	<pre><code>&lt;div class=&quot;slide&quot;&gt;
  &lt;h2&gt;Extensions&lt;/h2&gt;
  &lt;p&gt;Core gives you basic slide functionality...&lt;/p&gt;		
  &lt;ul&gt;
     &lt;li class=&quot;slide&quot;&gt;
        &lt;h3&gt;deck.goto&lt;/h3&gt;
        &lt;p&gt;Adds a shortcut key to jump to any slide number...&lt;/p&gt;
     &lt;/li&gt;
     &lt;li class=&quot;slide&quot;&gt;...&lt;/li&gt;	
     &lt;li class=&quot;slide&quot;&gt;...&lt;/li&gt;
     &lt;li class=&quot;slide&quot;&gt;...&lt;/li&gt;
  &lt;/ul&gt;
&lt;/div&gt;</code></pre>
</div>

<div class="slide" id="elements-images">
	<h2>Other Elements: Images</h2>
	<img src="http://placekitten.com/600/375" alt="Kitties">
	<pre><code>&lt;img src=&quot;http://placekitten.com/600/375&quot; alt=&quot;Kitties&quot;&gt;</code></pre>
</div>

<div class="slide" id="elements-blockquotes">
	<h2>Other Elements: Blockquotes</h2>
	<blockquote cite="http://example.org">
		<p>Food is an important part of a balanced diet.</p>
		<p><cite>Fran Lebowitz</cite></p>
	</blockquote>
	<pre><code>&lt;blockquote cite=&quot;http://example.org&quot;&gt;
  &lt;p&gt;Food is an important part of a balanced diet.&lt;/p&gt;
  &lt;p&gt;&lt;cite&gt;Fran Lebowitz&lt;/cite&gt;&lt;/p&gt;
&lt;/blockquote&gt;</code></pre>
</div>


<div class="slide" id="elements-videos">
	<h2>Other Elements: Video Embeds</h2>
	<p>Embed videos from your favorite online video service or with an HTML5 video&nbsp;element.</p>
	
	
	<pre><code>&lt;iframe src=&quot;http://player.vimeo.com/video/1063136?title=0&amp;amp;byline=0&amp;amp;portrait=0&quot; width=&quot;400&quot; height=&quot;225&quot; frameborder=&quot;0&quot;&gt;&lt;/iframe&gt;</code></pre>
</div>

<div class="slide" id="digging-deeper">
	<h2>Digging Deeper</h2>
	<p>If you want to learn about making your own themes, extending deck.js, and more, check out the&nbsp;<a href="../docs/">documentation</a>.</p>
</div>

<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="number" name="slidenum" id="goto-slide">
	<input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script>
<script>window.jQuery || document.write('<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.1.min.js">\x3C/script>')</script>

<!-- Deck Core and extensions -->
<script src="../core/deck.core.js"></script>
<script src="../extensions/menu/deck.menu.js"></script>
<script src="../extensions/goto/deck.goto.js"></script>
<script src="../extensions/status/deck.status.js"></script>
<script src="../extensions/navigation/deck.navigation.js"></script>
<script src="../extensions/hash/deck.hash.js"></script>

<!-- Specific to this page -->
<script src="introduction.js"></script>

</body>
</html>
